<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ILRI Livestock Genetics Assessment Platform</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        :root {
            --ilri-primary: #0066cc;
            --dairy-color: #4472C4;
            --poultry-color: #ED7D31;
            --small-ruminant-color: #70AD47;
            --beef-color: #C00000;
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 30px rgba(0,0,0,0.15);
            --shadow-xl: 0 20px 60px rgba(0,0,0,0.25);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            background-size: 200% 200%;
            animation: gradientShift 15s ease infinite;
            background-attachment: fixed;
            min-height: 100vh;
            padding: 20px;
            color: #2d3748;
        }
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .main-container {
            max-width: 1600px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            box-shadow: var(--shadow-xl), 0 0 100px rgba(102, 126, 234, 0.3);
            overflow: hidden;
            animation: fadeInUp 0.6s ease-out;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #3d5ca8 100%);
            color: white;
            padding: 50px 40px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }
        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.15) 0%, transparent 70%);
            animation: pulse 15s infinite;
        }
        .header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent);
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
        .header-content {
            position: relative;
            z-index: 1;
            text-align: center;
        }
        .header h1 {
            font-size: 2.8em;
            font-weight: 700;
            margin-bottom: 15px;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.3);
            letter-spacing: -0.5px;
        }
        .ilri-badge {
            background: rgba(255,255,255,0.25);
            backdrop-filter: blur(15px);
            padding: 12px 30px;
            border-radius: 30px;
            display: inline-block;
            font-size: 1em;
            border: 2px solid rgba(255,255,255,0.4);
            margin-top: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }
        .ilri-badge:hover {
            background: rgba(255,255,255,0.35);
            transform: scale(1.05);
            box-shadow: 0 12px 40px rgba(0,0,0,0.2);
        }
        .nav-tabs-custom {
            background: linear-gradient(to bottom, #f8fafc, #ffffff);
            border-bottom: 3px solid #e2e8f0;
            padding: 0;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        .nav-tabs-custom .nav-link {
            border: none;
            color: #64748b;
            padding: 18px 28px;
            font-weight: 600;
            font-size: 0.95em;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-bottom: 3px solid transparent;
            background: transparent;
            position: relative;
        }
        .nav-tabs-custom .nav-link::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 3px;
            background: var(--ilri-primary);
            transform: translateX(-50%);
            transition: width 0.3s;
        }
        .nav-tabs-custom .nav-link:hover {
            background: linear-gradient(to bottom, rgba(102, 126, 234, 0.08), transparent);
            color: var(--ilri-primary);
            transform: translateY(-2px);
        }
        .nav-tabs-custom .nav-link:hover::before {
            width: 80%;
        }
        .nav-tabs-custom .nav-link.active {
            background: linear-gradient(to bottom, white, rgba(255,255,255,0.9));
            color: var(--ilri-primary);
            border-bottom: 3px solid var(--ilri-primary);
            box-shadow: 0 -4px 20px rgba(102, 126, 234, 0.1);
        }
        .nav-tabs-custom .nav-link.active::before {
            width: 100%;
        }
        .content-area {
            padding: 40px;
            display: none;
        }
        .content-area.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .species-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }
        .species-card {
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
            border-radius: 20px;
            padding: 35px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 3px solid #e2e8f0;
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
        }
        .species-card.coming-soon {
            cursor: not-allowed;
            opacity: 0.7;
        }
        .species-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: var(--species-color);
            transform: scaleX(0);
            transition: transform 0.4s;
        }
        .species-card::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, var(--species-color) 0%, transparent 60%);
            opacity: 0;
            transition: opacity 0.4s;
            z-index: 0;
        }
        .species-card:hover::before {
            transform: scaleX(1);
        }
        .species-card:hover::after {
            opacity: 0.05;
        }
        .species-card:hover:not(.coming-soon) {
            transform: translateY(-15px) scale(1.02);
            box-shadow: 0 20px 60px rgba(0,0,0,0.2), 0 0 40px var(--species-color);
            border-color: var(--species-color);
        }
        .species-card.coming-soon:hover {
            transform: scale(1.02);
        }
        .species-card > * {
            position: relative;
            z-index: 1;
        }
        .species-icon {
            font-size: 5em;
            text-align: center;
            margin-bottom: 20px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            filter: drop-shadow(0 4px 12px rgba(0,0,0,0.1));
        }
        .species-card:hover .species-icon {
            transform: scale(1.15) rotate(5deg);
            filter: drop-shadow(0 8px 24px rgba(0,0,0,0.2));
        }
        .species-name {
            font-size: 1.4em;
            font-weight: 700;
            text-align: center;
            margin-bottom: 10px;
        }
        .program-name {
            font-size: 0.9em;
            font-weight: 600;
            text-align: center;
            margin-bottom: 10px;
            opacity: 0.85;
        }
        .species-description {
            text-align: center;
            font-size: 0.85em;
            opacity: 0.7;
        }
        .coming-soon-badge {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 700;
            text-align: center;
            margin-top: 10px;
            display: inline-block;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: linear-gradient(145deg, #ffffff, #f8fafc);
            border-radius: 16px;
            padding: 25px;
            text-align: center;
            box-shadow: var(--shadow-md);
            border: 2px solid #e2e8f0;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--species-color), transparent);
            animation: shimmer 3s infinite;
        }
        @keyframes shimmer {
            0%, 100% { transform: translateX(-100%); }
            50% { transform: translateX(100%); }
        }
        .stat-card:hover {
            transform: translateY(-8px) scale(1.03);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
            border-color: var(--species-color);
        }
        .stat-card:hover .stat-value {
            transform: scale(1.1);
            text-shadow: 0 0 20px var(--species-color);
        }
        .stat-value {
            font-size: 2.5em;
            font-weight: 700;
            color: var(--species-color);
            margin-bottom: 5px;
            transition: all 0.3s;
        }
        .stat-label {
            font-size: 0.85em;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }
        .assessment-section-header {
            background: linear-gradient(135deg, var(--species-color), rgba(0,0,0,0.1));
            color: white;
            padding: 20px 28px;
            border-radius: 16px;
            margin: 35px 0 25px 0;
            font-weight: 700;
            font-size: 1.3em;
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
            position: relative;
            overflow: hidden;
        }
        .assessment-section-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transform: translateX(-100%);
            animation: headerShine 3s infinite;
        }
        @keyframes headerShine {
            0%, 100% { transform: translateX(-100%); }
            50% { transform: translateX(100%); }
        }
        .question-card {
            background: linear-gradient(145deg, #ffffff, #fafbfc);
            padding: 28px;
            border-radius: 16px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            border: 2px solid #e2e8f0;
            border-left: 6px solid var(--species-color);
            transition: all 0.3s;
            position: relative;
        }
        .question-card::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 16px;
            padding: 2px;
            background: linear-gradient(135deg, var(--species-color), transparent);
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
        }
        .question-card:hover {
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
            transform: translateX(8px);
            border-color: var(--species-color);
        }
        .question-card:hover::before {
            opacity: 0.3;
        }
        .question-label {
            font-weight: 600;
            font-size: 1.05em;
            margin-bottom: 12px;
            color: #1e293b;
        }
        .form-select, .form-control {
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 10px 14px;
            font-size: 0.95em;
            transition: all 0.3s;
        }
        .form-select:focus, .form-control:focus {
            border-color: var(--species-color);
            box-shadow: 0 0 0 3px rgba(68, 114, 196, 0.1);
            outline: none;
        }
        .form-range {
            height: 10px;
            background: linear-gradient(to right,
                #ef4444 0%,
                #f59e0b 20%,
                #fbbf24 40%,
                #84cc16 60%,
                #10b981 80%,
                #059669 100%
            );
            border-radius: 10px;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
        .form-range::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }
        .form-range::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 6px 16px rgba(0,0,0,0.4);
        }
        .form-range::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }
        .form-range::-moz-range-track {
            background: transparent;
            border: none;
        }
        .form-range:focus {
            outline: none;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15), 0 0 0 3px rgba(102, 126, 234, 0.2);
        }
        .score-display {
            background: linear-gradient(135deg, var(--species-color), rgba(0,0,0,0.2));
            color: white;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            font-size: 1.6em;
            font-weight: 700;
            margin-top: 15px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
            position: relative;
            overflow: hidden;
        }
        .score-display::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.2) 0%, transparent 70%);
        }
        .btn-custom {
            padding: 12px 30px;
            border-radius: 12px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: var(--shadow-md);
            margin: 5px;
            position: relative;
            overflow: hidden;
        }
        .btn-custom::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        .btn-custom:hover::before {
            width: 300px;
            height: 300px;
        }
        .btn-custom:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(0,0,0,0.25);
        }
        .btn-primary-custom {
            background: linear-gradient(135deg, #0066cc, #0052a3, #003d7a);
            color: white;
        }
        .btn-success-custom {
            background: linear-gradient(135deg, #10b981, #059669, #047857);
            color: white;
        }
        .btn-info-custom {
            background: linear-gradient(135deg, #06b6d4, #0891b2, #0e7490);
            color: white;
        }
        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626, #b91c1c);
            color: white;
        }
        .btn-secondary {
            background: linear-gradient(135deg, #64748b, #475569, #334155);
            color: white;
        }
        .chart-container {
            background: white;
            border-radius: 16px;
            padding: 30px;
            margin: 25px 0;
            box-shadow: var(--shadow-md);
            border: 2px solid #e2e8f0;
        }
        .view-section {
            background: #f8fafc;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            border: 2px solid #e2e8f0;
        }
        .view-section h4 {
            color: var(--dairy-color);
            font-weight: 700;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid var(--dairy-color);
        }
        .view-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #e2e8f0;
        }
        .view-item:last-child {
            border-bottom: none;
        }
        .view-label {
            font-weight: 600;
            color: #475569;
        }
        .view-value {
            color: #1e293b;
            font-weight: 500;
        }
        .score-badge {
            display: inline-block;
            padding: 6px 16px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.9em;
        }
        .score-excellent {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }
        .score-good {
            background: linear-gradient(135deg, #84cc16, #65a30d);
            color: white;
        }
        .score-fair {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }
        .score-poor {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }
        .assessment-list {
            display: grid;
            gap: 15px;
        }
        .assessment-item-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e2e8f0;
            cursor: pointer;
            transition: all 0.3s;
        }
        .assessment-item-card:hover {
            border-color: var(--dairy-color);
            box-shadow: var(--shadow-md);
            transform: translateX(5px);
        }
        .assessment-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .assessment-date {
            font-size: 0.85em;
            color: #64748b;
        }
        .comment-section {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px dashed #e2e8f0;
        }
        .comment-section label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 0.9em;
            color: #475569;
        }
        .assessment-comment {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-family: inherit;
            font-size: 0.95em;
            resize: vertical;
            min-height: 80px;
            transition: all 0.3s;
            background: #ffffff;
        }
        .assessment-comment:focus {
            outline: none;
            border-color: var(--species-color);
            box-shadow: 0 0 0 3px rgba(68, 114, 196, 0.1);
            background: #fefefe;
        }
        .assessment-comment::placeholder {
            color: #94a3b8;
            font-style: italic;
        }
        .info-banner {
            background: linear-gradient(135deg, #e0f2fe, #dbeafe);
            border-left: 5px solid #3b82f6;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .info-banner h4 {
            color: #1e40af;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        .info-banner p {
            color: #1e3a8a;
            margin: 5px 0;
            line-height: 1.6;
        }
        @media (max-width: 768px) {
            .header h1 { font-size: 1.8em; }
            .nav-tabs-custom .nav-link { padding: 12px 15px; font-size: 0.85em; }
            .content-area { padding: 20px; }
            .species-grid { grid-template-columns: 1fr; }
        }
        #print-report {
            display: none;
            padding: 40px;
            font-family: 'Inter', Arial, sans-serif;
            background: white;
            color: #000;
        }
        #print-report h1 {
            font-size: 28px;
            margin-bottom: 10px;
            color: #1e3c72;
            border-bottom: 3px solid #1e3c72;
            padding-bottom: 10px;
        }
        #print-report h2 {
            font-size: 20px;
            margin-top: 30px;
            margin-bottom: 15px;
            color: #2a5298;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 8px;
        }
        #print-report .meta {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
            background: #f8fafc;
            padding: 20px;
            border-radius: 8px;
        }
        #print-report .meta-item {
            padding: 10px;
            border-left: 3px solid #3b82f6;
            background: white;
        }
        #print-report .meta-label {
            font-weight: 600;
            color: #64748b;
            font-size: 12px;
            text-transform: uppercase;
        }
        #print-report .meta-value {
            font-size: 16px;
            color: #1e293b;
            margin-top: 5px;
        }
        #print-report table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            margin-bottom: 30px;
        }
        #print-report th, #print-report td {
            border: 1px solid #e2e8f0;
            padding: 12px;
            text-align: left;
        }
        #print-report th {
            background: #f1f5f9;
            font-weight: 600;
            color: #1e293b;
        }
        #print-report .score-cell {
            font-weight: 700;
            text-align: center;
        }
        #print-report .comment-cell {
            font-size: 14px;
            color: #475569;
            font-style: italic;
        }
        #print-report .summary-box {
            background: #f0f9ff;
            border: 2px solid #3b82f6;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        @media print {
            body * {
                visibility: hidden !important;
            }
            #print-report, #print-report * {
                visibility: visible !important;
            }
            #print-report {
                display: block !important;
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div id="print-report"></div>
    
    <div class="main-container">
        <div class="header">
            <div class="header-content">
                <h1><i class="fas fa-dna"></i> ILRI Livestock Genetics Assessment</h1>
                <p>International Livestock Research Institute</p>
                <div class="ilri-badge">
                    <i class="fas fa-microscope"></i> Professional Breeding Program Evaluation
                </div>
            </div>
        </div>
        <ul class="nav nav-tabs nav-tabs-custom">
            <li class="nav-item">
                <button class="nav-link active" onclick="showTab('home')">
                    <i class="fas fa-home"></i> Home
                </button>
            </li>
            <li class="nav-item">
                <button class="nav-link" onclick="showTab('assessment')">
                    <i class="fas fa-clipboard-check"></i> Assessment
                </button>
            </li>
            <li class="nav-item">
                <button class="nav-link" onclick="showTab('view')">
                    <i class="fas fa-eye"></i> View
                </button>
            </li>
            <li class="nav-item">
                <button class="nav-link" onclick="showTab('results')">
                    <i class="fas fa-chart-line"></i> Results
                </button>
            </li>
            <li class="nav-item">
                <button class="nav-link" onclick="showTab('export')">
                    <i class="fas fa-download"></i> Export
                </button>
            </li>
        </ul>
        
        <div id="home" class="content-area active">
            <div style="text-align: center; padding: 50px 20px;">
                <h2 style="font-size: 2.5em; margin-bottom: 20px;">Welcome to ILRI Assessment Platform</h2>
                <p style="font-size: 1.2em; color: #64748b; max-width: 700px; margin: 0 auto 40px;">
                    Evaluate breeding programs for dairy cattle, poultry, small ruminants, and beef cattle across multiple countries.
                </p>
                <button class="btn-custom btn-primary-custom btn-lg" onclick="showTab('assessment')">
                    <i class="fas fa-rocket"></i> Start Assessment
                </button>
                <button class="btn-custom btn-info-custom btn-lg" onclick="showTab('view')">
                    <i class="fas fa-eye"></i> View Assessments
                </button>
            </div>
        </div>
        
        <div id="assessment" class="content-area">
            <div id="species-selector">
                <h2 style="text-align: center; font-size: 2em; margin-bottom: 30px;">Select Your Breeding Program</h2>
                
                <div class="species-grid">
                    <div class="species-card" style="--species-color: var(--dairy-color)" onclick="loadSpecies('dairy')">
                        <div class="species-icon">üêÑ</div>
                        <h3 class="species-name">Dairy Cattle</h3>
                        <p class="program-name">African Dairy Genetics (ADG)</p>
                        <p class="species-description">Ethiopia ‚Ä¢ Tanzania ‚Ä¢ Kenya ‚Ä¢ Nigeria</p>
                    </div>
                    <div class="species-card" style="--species-color: var(--poultry-color)" onclick="loadSpecies('poultry')">
                        <div class="species-icon">üêì</div>
                        <h3 class="species-name">Poultry Assessment</h3>
                        <p class="program-name">Young Breeding Program Evaluation</p>
                        <p class="species-description">Ethiopia ‚Ä¢ Tanzania ‚Ä¢ Nigeria ‚Ä¢ Cambodia ‚Ä¢ Vietnam</p>
                    </div>
                    <div class="species-card coming-soon" style="--species-color: var(--small-ruminant-color)" onclick="showComingSoon('Small Ruminants')">
                        <div class="species-icon">üêë</div>
                        <h3 class="species-name">Small Ruminants</h3>
                        <p class="program-name">Sheep & Goat Programs</p>
                        <p class="species-description">Multi-country ‚Ä¢ Framework in development</p>
                        <div class="coming-soon-badge">üöß Coming Soon</div>
                    </div>
                    <div class="species-card coming-soon" style="--species-color: var(--beef-color)" onclick="showComingSoon('Beef Cattle')">
                        <div class="species-icon">üêÇ</div>
                        <h3 class="species-name">Beef Cattle</h3>
                        <p class="program-name">Beef Genetics Programs</p>
                        <p class="species-description">Multi-country ‚Ä¢ Framework in development</p>
                        <div class="coming-soon-badge">üöß Coming Soon</div>
                    </div>
                </div>
            </div>
            
            <div id="dairy-assessment" style="display: none; --species-color: var(--dairy-color)">
                <button class="btn-custom btn-secondary" onclick="backToSpecies()" style="margin-bottom: 20px;">
                    <i class="fas fa-arrow-left"></i> Back to Species Selection
                </button>
                <h2 style="font-size: 2em; margin-bottom: 20px;">üêÑ Dairy Cattle Assessment (ADG/TDGG)</h2>
                
                <div class="info-banner">
                    <h4><i class="fas fa-info-circle"></i> Scoring System (0-5 Scale)</h4>
                    <p><strong>0 = Not Present</strong> - No evidence of implementation</p>
                    <p><strong>1 = Very Weak</strong> - Recognized but not implemented; major gaps</p>
                    <p><strong>2 = Weak</strong> - Partially implemented, inconsistent, informal</p>
                    <p><strong>3 = Moderate</strong> - Basic implementation, documentation exists, somewhat reliable</p>
                    <p><strong>4 = Strong</strong> - Fully implemented, well-documented, reliable, staff follow procedures</p>
                    <p><strong>5 = Excellent</strong> - Best practice, institutionalized, validated, continuous improvement, high impact</p>
                </div>
                
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 30px;">
                    <div class="row g-3">
                        <div class="col-md-3">
                            <label>Evaluator Name</label>
                            <input type="text" class="form-control" id="dairy-evaluator">
                        </div>
                        <div class="col-md-3">
                            <label>Date</label>
                            <input type="date" class="form-control" id="dairy-date">
                        </div>
                        <div class="col-md-3">
                            <label>Country</label>
                            <select class="form-select" id="dairy-country">
                                <option value="">Select</option>
                                <option value="ethiopia">Ethiopia</option>
                                <option value="tanzania">Tanzania</option>
                                <option value="kenya">Kenya</option>
                                <option value="nigeria">Nigeria</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label>Breed</label>
                            <input type="text" class="form-control" id="dairy-breed" placeholder="e.g., Holstein">
                        </div>
                    </div>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="dairy-total">0</div>
                        <div class="stat-label">Total Score / 100</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="dairy-status">--</div>
                        <div class="stat-label">Status</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="dairy-completion">0%</div>
                        <div class="stat-label">Completion</div>
                    </div>
                </div>

                <div id="dairy-framework"></div>

                <div style="text-align: center; margin-top: 40px;">
                    <button class="btn-custom btn-primary-custom btn-lg" onclick="saveDairyAssessment()">
                        <i class="fas fa-save"></i> Save Assessment
                    </button>
                    <button class="btn-custom btn-success-custom btn-lg" onclick="showTab('results')">
                        <i class="fas fa-chart-line"></i> View Results
                    </button>
                </div>
            </div>
            
            <div id="poultry-assessment" style="display: none; --species-color: var(--poultry-color)">
                <button class="btn-custom btn-secondary" onclick="backToSpecies()" style="margin-bottom: 20px;">
                    <i class="fas fa-arrow-left"></i> Back to Species Selection
                </button>
                <h2 style="font-size: 2em; margin-bottom: 20px;">üêì Poultry Assessment - Young Breeding Program</h2>
                
                <div class="info-banner">
                    <h4><i class="fas fa-info-circle"></i> Young Program Evaluation (0-5 Scale)</h4>
                    <p><strong>This assessment is designed for young/developing breeding programs.</strong></p>
                    <p><strong>0 = None</strong> - Component completely absent or not planned</p>
                    <p><strong>1-2 = Initial/Planned</strong> - Basic planning or very early implementation</p>
                    <p><strong>3 = Developing</strong> - Partial implementation with documented procedures</p>
                    <p><strong>4 = Functional</strong> - Core components operational and effective</p>
                    <p><strong>5 = Mature/Optimized</strong> - Well-established for current program stage</p>
                    
                    <p style="margin-top: 15px; padding: 15px; background: rgba(59, 130, 246, 0.1); border-left: 4px solid #3b82f6; border-radius: 6px;">
                        <strong><i class="fas fa-exclamation-triangle"></i> Important Evaluation Guidelines for Young Programs:</strong><br>
                        ‚Ä¢ Assess based on <strong>documented plans and SOPs</strong> rather than only realized outcomes<br>
                        ‚Ä¢ Consider the program's <strong>current stage and age</strong> (e.g., programs starting 2020-present)<br>
                        ‚Ä¢ Focus on what is <strong>in place, documented, and planned</strong> for future phases<br>
                        ‚Ä¢ Do NOT penalize for outcomes naturally expected only after 8-10 years (e.g., full dissemination, long-term genetic gain)<br>
                        ‚Ä¢ Optional systems (e.g., open vs. closed nucleus) should be evaluated based on <strong>appropriateness to context</strong>, not preference
                    </p>
                    
                    <p style="margin-top: 10px; font-style: italic; color: #1e40af;">
                        <i class="fas fa-lightbulb"></i> <strong>Note:</strong> Please provide detailed remarks for each criterion to document current status, evidence in SOPs, and future plans.
                    </p>
                </div>
                
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 30px;">
                    <div class="row g-3">
                        <div class="col-md-3">
                            <label>Evaluator Name</label>
                            <input type="text" class="form-control" id="poultry-evaluator">
                        </div>
                        <div class="col-md-3">
                            <label>Date</label>
                            <input type="date" class="form-control" id="poultry-date">
                        </div>
                        <div class="col-md-3">
                            <label>Country</label>
                            <select class="form-select" id="poultry-country">
                                <option value="">Select</option>
                                <option value="ethiopia">Ethiopia</option>
                                <option value="tanzania">Tanzania</option>
                                <option value="nigeria">Nigeria</option>
                                <option value="cambodia">Cambodia</option>
                                <option value="vietnam">Vietnam</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label>Breed/Line</label>
                            <input type="text" class="form-control" id="poultry-breed" placeholder="e.g., Kuroiler">
                        </div>
                    </div>
                </div>
                <div class="stats-grid">
                    <div class="stat-card" style="--species-color: var(--poultry-color)">
                        <div class="stat-value" id="poultry-total">0</div>
                        <div class="stat-label">Total Score / 100</div>
                    </div>
                    <div class="stat-card" style="--species-color: var(--poultry-color)">
                        <div class="stat-value" id="poultry-status">--</div>
                        <div class="stat-label">Status</div>
                    </div>
                    <div class="stat-card" style="--species-color: var(--poultry-color)">
                        <div class="stat-value" id="poultry-completion">0%</div>
                        <div class="stat-label">Completion</div>
                    </div>
                </div>
                
                <div id="poultry-framework"></div>
                
                <div style="text-align: center; margin-top: 40px;">
                    <button class="btn-custom btn-primary-custom btn-lg" onclick="savePoultryAssessment()">
                        <i class="fas fa-save"></i> Save Assessment
                    </button>
                    <button class="btn-custom btn-success-custom btn-lg" onclick="showTab('results')">
                        <i class="fas fa-chart-line"></i> View Results
                    </button>
                </div>
            </div>
        </div>
        
        <div id="view" class="content-area">
            <h2 style="text-align: center; font-size: 2em; margin-bottom: 30px;"><i class="fas fa-eye"></i> View Saved Assessments</h2>
            
            <div id="assessments-list" class="assessment-list"></div>
            
            <div id="no-assessments" style="text-align: center; padding: 50px 20px; display: none;">
                <i class="fas fa-folder-open" style="font-size: 5em; color: #cbd5e1; margin-bottom: 20px;"></i>
                <h3 style="color: #64748b;">No Assessments Found</h3>
                <p style="color: #94a3b8; margin-bottom: 30px;">You haven't saved any assessments yet. Start a new assessment to get started!</p>
                <button class="btn-custom btn-primary-custom" onclick="showTab('assessment')">
                    <i class="fas fa-plus"></i> Create New Assessment
                </button>
            </div>
            
            <div id="view-detail" style="display: none;">
                <button class="btn-custom btn-secondary mb-4" onclick="backToAssessmentList()">
                    <i class="fas fa-arrow-left"></i> Back to List
                </button>
                <div class="view-section">
                    <h4><i class="fas fa-info-circle"></i> Assessment Information</h4>
                    <div class="view-item">
                        <span class="view-label">Program:</span>
                        <span class="view-value" id="view-program">-</span>
                    </div>
                    <div class="view-item">
                        <span class="view-label">Evaluator:</span>
                        <span class="view-value" id="view-evaluator">-</span>
                    </div>
                    <div class="view-item">
                        <span class="view-label">Date:</span>
                        <span class="view-value" id="view-date">-</span>
                    </div>
                    <div class="view-item">
                        <span class="view-label">Country:</span>
                        <span class="view-value" id="view-country">-</span>
                    </div>
                    <div class="view-item">
                        <span class="view-label">Breed:</span>
                        <span class="view-value" id="view-breed">-</span>
                    </div>
                </div>
                <div class="view-section">
                    <h4><i class="fas fa-chart-bar"></i> Overall Scores</h4>
                    <div class="view-item">
                        <span class="view-label">Total Score:</span>
                        <span class="view-value"><strong id="view-total-score">0</strong> / 100</span>
                    </div>
                    <div class="view-item">
                        <span class="view-label">Status:</span>
                        <span class="view-value">
                            <span class="score-badge" id="view-status-badge">-</span>
                        </span>
                    </div>
                    <div class="view-item">
                        <span class="view-label">Completion:</span>
                        <span class="view-value" id="view-completion">0%</span>
                    </div>
                </div>
                <div class="view-section">
                    <h4><i class="fas fa-list-check"></i> Section Scores</h4>
                    <div id="view-sections"></div>
                </div>
                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn-custom btn-primary-custom" onclick="loadAssessmentForEdit()">
                        <i class="fas fa-edit"></i> Edit Assessment
                    </button>
                    <button class="btn-custom btn-danger" onclick="deleteCurrentAssessment()">
                        <i class="fas fa-trash"></i> Delete Assessment
                    </button>
                </div>
            </div>
        </div>
        
        <div id="results" class="content-area">
            <h2 style="text-align: center; font-size: 2em; margin-bottom: 20px;">Assessment Results & Analytics</h2>
            
            <div class="stats-grid">
                <div class="stat-card" style="--species-color: var(--dairy-color)">
                    <div class="stat-value" id="results-total">0</div>
                    <div class="stat-label">Total Score / 100</div>
                </div>
                <div class="stat-card" style="--species-color: var(--dairy-color)">
                    <div class="stat-value" id="results-status">--</div>
                    <div class="stat-label">Program Status</div>
                </div>
            </div>
            
            <div class="chart-container">
                <div style="text-align: center; padding: 80px 40px;">
                    <i class="fas fa-chart-line" style="font-size: 5em; color: #cbd5e1; margin-bottom: 25px;"></i>
                    <h3 style="color: #475569; margin-bottom: 15px; font-size: 1.8em;">
                        <i class="fas fa-sparkles"></i> Interactive Results Visualization
                    </h3>
                    <p style="color: #64748b; font-size: 1.2em; max-width: 600px; margin: 0 auto 20px;">
                        Hover over bars to see detailed scores
                    </p>
                    <div style="background: linear-gradient(135deg, #e0f2fe, #dbeafe); border-left: 5px solid #3b82f6; padding: 20px; border-radius: 12px; max-width: 700px; margin: 30px auto;">
                        <p style="color: #1e40af; font-size: 1.1em; margin: 0;">
                            <strong><i class="fas fa-clock"></i> Coming Soon</strong><br>
                            <span style="font-size: 0.95em;">Interactive visualization features will be available in the next update</span>
                        </p>
                    </div>
                </div>
                
                <!-- Hidden chart canvas for future use -->
                <div style="display: none;">
                    <canvas id="resultsChart"></canvas>
                </div>
            </div>
        </div>
        
        <div id="export" class="content-area">
            <h2 style="text-align: center; font-size: 2em; margin-bottom: 20px;">Export Assessment Reports</h2>
            <p style="text-align: center; color: #64748b; margin-bottom: 40px; font-size: 1.1em;">
                Downloadable Excel and PDF reports will be available soon
            </p>
            
            <div style="max-width: 800px; margin: 0 auto;">
                <div class="question-card">
                    <div style="text-align: center;">
                        <i class="fas fa-file-excel" style="font-size: 3em; color: #10b981; margin-bottom: 15px;"></i>
                        <h4>Excel Report</h4>
                        <p style="color: #64748b; margin: 10px 0 20px 0;">Comprehensive data export with all scores and analysis</p>
                        <button class="btn-custom btn-success-custom" onclick="exportExcel()">
                            <i class="fas fa-download"></i> Download Excel
                        </button>
                    </div>
                </div>
                
                <div class="question-card">
                    <div style="text-align: center;">
                        <i class="fas fa-file-pdf" style="font-size: 3em; color: #ef4444; margin-bottom: 15px;"></i>
                        <h4>PDF Report</h4>
                        <p style="color: #64748b; margin: 10px 0 20px 0;">Professional document for presentations and sharing</p>
                        <button class="btn-custom btn-primary-custom" onclick="generatePDFReport()">
                            <i class="fas fa-file-pdf"></i> Generate PDF
                        </button>
                    </div>
                </div>
                
                <div class="question-card">
                    <div style="text-align: center;">
                        <i class="fas fa-database" style="font-size: 3em; color: #3b82f6; margin-bottom: 15px;"></i>
                        <h4>JSON Data</h4>
                        <p style="color: #64748b; margin: 10px 0 20px 0;">Raw data backup in JSON format</p>
                        <button class="btn-custom btn-info-custom" onclick="exportJSON()">
                            <i class="fas fa-code"></i> Export JSON
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script>
        let currentSpecies = null;
        let charts = {};
        let currentViewAssessment = null;

        // NEW DAIRY CRITERIA - 40 questions across 9 sections (0-5 scale)
        const DAIRY_CRITERIA = [
            // Section 1: Program Governance & Management (4 questions)
            { id: 'q1_1', section: '1. Program Governance & Management', weight: 0.025, title: 'Existence of clear breeding goals aligned with national strategies' },
            { id: 'q1_2', section: '1. Program Governance & Management', weight: 0.025, title: 'Defined roles and responsibilities for program coordination and management' },
            { id: 'q1_3', section: '1. Program Governance & Management', weight: 0.025, title: 'Availability of operational budget and financial tracking system' },
            { id: 'q1_4', section: '1. Program Governance & Management', weight: 0.025, title: 'Regular review meetings and documentation of decisions' },
            
            // Section 2: Data Collection & Recording (6 questions)
            { id: 'q2_1', section: '2. Data Collection & Recording', weight: 0.025, title: 'Standardized data collection protocols for both phenotypic and pedigree data' },
            { id: 'q2_2', section: '2. Data Collection & Recording', weight: 0.025, title: 'Use of digital or mobile data capture tools (e.g., ADGG App)' },
            { id: 'q2_3', section: '2. Data Collection & Recording', weight: 0.025, title: 'Frequency and accuracy of data uploads to the central database' },
            { id: 'q2_4', section: '2. Data Collection & Recording', weight: 0.025, title: 'Availability of trained enumerators and field staff' },
            { id: 'q2_5', section: '2. Data Collection & Recording', weight: 0.025, title: 'Procedures for data validation and error checking' },
            { id: 'q2_6', section: '2. Data Collection & Recording', weight: 0.025, title: 'Regular feedback to farmers' },
            
            // Section 3: Data Management & Quality Control (5 questions)
            { id: 'q3_1', section: '3. Data Management & Quality Control', weight: 0.025, title: 'Existence of a centralized database and access protocols' },
            { id: 'q3_2', section: '3. Data Management & Quality Control', weight: 0.025, title: 'Backup and data security procedures in place' },
            { id: 'q3_3', section: '3. Data Management & Quality Control', weight: 0.025, title: 'Completeness of animal records (birth, weights, parentage, dates etc.)' },
            { id: 'q3_4', section: '3. Data Management & Quality Control', weight: 0.025, title: 'Routine data cleaning and quality control reports generated' },
            { id: 'q3_5', section: '3. Data Management & Quality Control', weight: 0.025, title: 'Cross-checking of genotype-pedigree consistency' },
            
            // Section 4: Genetic Evaluation (5 questions)
            { id: 'q4_1', section: '4. Genetic Evaluation', weight: 0.025, title: 'Use of appropriate genetic models (e.g., animal model, maternal effects, etc)' },
            { id: 'q4_2', section: '4. Genetic Evaluation', weight: 0.025, title: 'Frequency of running evaluations and updates to EBVs' },
            { id: 'q4_3', section: '4. Genetic Evaluation', weight: 0.025, title: 'Availability of trained quantitative geneticist' },
            { id: 'q4_4', section: '4. Genetic Evaluation', weight: 0.025, title: 'Validation and interpretation of genetic trends' },
            { id: 'q4_5', section: '4. Genetic Evaluation', weight: 0.025, title: 'Dissemination of genetic evaluation results to stakeholders' },
            
            // Section 5: Breeding & Selection Implementation (5 questions)
            { id: 'q5_1', section: '5. Breeding & Selection Implementation', weight: 0.025, title: 'Defined selection criteria and ranking procedures' },
            { id: 'q5_2', section: '5. Breeding & Selection Implementation', weight: 0.025, title: 'Traceability of selected animals and their distribution' },
            { id: 'q5_3', section: '5. Breeding & Selection Implementation', weight: 0.025, title: 'Monitoring of genetic gain across generations' },
            { id: 'q5_4', section: '5. Breeding & Selection Implementation', weight: 0.025, title: 'Use of nucleus and multiplier herds' },
            { id: 'q5_5', section: '5. Breeding & Selection Implementation', weight: 0.025, title: 'Integration of farmers\' preferences and local adaptation traits' },
            
            // Section 6: Farmer Participation & Capacity Building (4 questions)
            { id: 'q6_1', section: '6. Farmer Participation & Capacity Building', weight: 0.025, title: 'Farmer engagement in selection process' },
            { id: 'q6_2', section: '6. Farmer Participation & Capacity Building', weight: 0.025, title: 'Training provided on record keeping, animal management, and breeding' },
            { id: 'q6_3', section: '6. Farmer Participation & Capacity Building', weight: 0.025, title: 'Feedback mechanisms between farmers and program coordinators' },
            { id: 'q6_4', section: '6. Farmer Participation & Capacity Building', weight: 0.025, title: 'Gender and youth inclusion in breeding activities' },
            
            // Section 7: Reproductive Technologies & Services (3 questions)
            { id: 'q7_1', section: '7. Reproductive Technologies & Services', weight: 0.025, title: 'Availability and use of AI or controlled mating strategies and natural mating' },
            { id: 'q7_2', section: '7. Reproductive Technologies & Services', weight: 0.025, title: 'Recording of mating, conception, and calving data' },
            { id: 'q7_3', section: '7. Reproductive Technologies & Services', weight: 0.025, title: 'Genotyping' },
            
            // Section 8: Monitoring, Evaluation & Reporting (4 questions)
            { id: 'q8_1', section: '8. Monitoring, Evaluation & Reporting', weight: 0.025, title: 'Regular internal or external audits conducted' },
            { id: 'q8_2', section: '8. Monitoring, Evaluation & Reporting', weight: 0.025, title: 'Key performance indicators defined (KPIs) and tracked over time' },
            { id: 'q8_3', section: '8. Monitoring, Evaluation & Reporting', weight: 0.025, title: 'Documentation of lessons learned and best practices' },
            { id: 'q8_4', section: '8. Monitoring, Evaluation & Reporting', weight: 0.025, title: 'Dissemination of results to stakeholders and partners' },
            
            // Section 9: Sustainability & Partnerships (4 questions)
            { id: 'q9_1', section: '9. Sustainability & Partnerships', weight: 0.025, title: 'Partnerships with national research systems, universities, policy makers and private sector' },
            { id: 'q9_2', section: '9. Sustainability & Partnerships', weight: 0.025, title: 'Long-term sustainability strategy in place' },
            { id: 'q9_3', section: '9. Sustainability & Partnerships', weight: 0.025, title: 'Evidence of scaling and replication of the model' },
            { id: 'q9_4', section: '9. Sustainability & Partnerships', weight: 0.025, title: 'Donor and stakeholder engagement' }
        ];

        // Poultry criteria with exact scoring descriptions from rubric
        const POULTRY_CRITERIA = [
            { 
                id: 'q11', 
                weight: 0.04, 
                title: '1.1 Clear breeding objective (traits, production system)',
                scores: [
                    'None',
                    'Very general',
                    'Written but not used',
                    'Written & used annually',
                    'Written, stakeholder-validated',
                    'Annually updated, validated, and aligned with national breeding policy'
                ]
            },
            { 
                id: 'q12', 
                weight: 0.06, 
                title: '1.2 Defined breeding structure (nucleus ‚Üí multiplier ‚Üí farmers)',
                scores: [
                    'None',
                    'Single farm',
                    'Nucleus only',
                    'Nucleus + multiplier',
                    'Full 3-tier',
                    'Fully functional 3-tier with traceability, SOPs & annual audits'
                ]
            },
            { 
                id: 'q21', 
                weight: 0.05, 
                title: '2.1 Effective population size / inbreeding monitoring',
                scores: [
                    'No idea',
                    'Some pedigree but unused',
                    'Documented but rarely used',
                    'Inbreeding tracked irregularly',
                    'Ne/f tracked annually',
                    'Inbreeding & Ne used proactively for mating design & strategic planning'
                ]
            },
            { 
                id: 'q22', 
                weight: 0.05, 
                title: '2.2 Use of superior external genetics / open nucleus',
                scores: [
                    'None',
                    'Occasional but undocumented',
                    'Documented but rare',
                    'Annual intake of best sires',
                    'Systematic intake with proof',
                    'Performance-tested sires with genomic screening & standardized intake protocols'
                ]
            },
            { 
                id: 'q31', 
                weight: 0.05, 
                title: '3.1 Individual identification (birds/families/pens)',
                scores: [
                    'None',
                    'Pen only',
                    'Mixed pen + few IDs',
                    'All nucleus ID\'d',
                    'Full traceability to hatch/batch',
                    'Full digital ID system integrated with central database'
                ]
            },
            { 
                id: 'q32', 
                weight: 0.07, 
                title: '3.2 Trait recording (egg no., egg weight, BW, mortality)',
                scores: [
                    'None',
                    '1 trait',
                    '2 traits',
                    '‚â•3 traits irregular',
                    'Full trait set per SOP',
                    'High-frequency trait recording integrated with automated sensing technologies'
                ]
            },
            { 
                id: 'q33', 
                weight: 0.10, 
                title: '3.3 Data capture system (digital, QC, backups)',
                scores: [
                    'Paper only',
                    'Paper + Excel',
                    'Digital but no QC',
                    'Digital + basic QC',
                    'Digital + backups',
                    'Digital, automated QC, real-time dashboards & cloud-based backups'
                ]
            },
            { 
                id: 'q41', 
                weight: 0.08, 
                title: '4.1 Selection method',
                scores: [
                    'None',
                    'Visual/age',
                    'Phenotype + simple index',
                    'BLUP yearly',
                    'Multi-trait BLUP',
                    'Genomic evaluation/SSGBLUP with multi-trait selection index'
                ]
            },
            { 
                id: 'q42', 
                weight: 0.06, 
                title: '4.2 Selection intensity (esp. males)',
                scores: [
                    'Keep all',
                    'Minimal culling',
                    'Some culling',
                    '20‚Äì30% retained',
                    'Optimized intensity by sex/line',
                    'Optimized with mating plans + economic weights + inbreeding constraints'
                ]
            },
            { 
                id: 'q43', 
                weight: 0.06, 
                title: '4.3 Mating design & inbreeding control',
                scores: [
                    'Random',
                    'Pairing but no records',
                    'Avoid sib matings only',
                    'Planned',
                    'Planned + monitoring',
                    'Genomic mating (MateSel or equivalent) minimizing ŒîF & maximizing gain'
                ]
            },
            { 
                id: 'q51', 
                weight: 0.05, 
                title: '5.1 Standard health/vaccination protocol in nucleus',
                scores: [
                    'None',
                    'Irregular',
                    'Written but not followed',
                    'Followed in nucleus',
                    'Followed in nucleus + multipliers',
                    'Integrated herd-health plan with audits & digital recording'
                ]
            },
            { 
                id: 'q52', 
                weight: 0.05, 
                title: '5.2 Robustness/adaptation trait included (survival, field test)',
                scores: [
                    'Not considered',
                    'Observed only',
                    'Recorded irregularly',
                    'Used in selection index',
                    'Separate test line',
                    'Formal resilience testing + environment-specific breeding values'
                ]
            },
            { 
                id: 'q61', 
                weight: 0.06, 
                title: '6.1 Functional multiplication / hatchery chain',
                scores: [
                    'None',
                    'Ad hoc supply',
                    'One small hatchery',
                    'Regular supply',
                    'Structured national roll-out',
                    'National, scalable distribution system with certified multipliers'
                ]
            },
            { 
                id: 'q62', 
                weight: 0.09, 
                title: '6.2 Feedback from field (performance of distributed chicks)',
                scores: [
                    'None',
                    'Anecdotal',
                    'Occasional surveys',
                    'Annual field tests',
                    'Feedback loop integrated',
                    'Real-time digital feedback system linked to genetic evaluation'
                ]
            },
            { 
                id: 'q63', 
                weight: 0.05, 
                title: '6.3 Alignment to market / farmer preference (egg colour, body size, plumage)',
                scores: [
                    'Not considered',
                    'Considered once',
                    'Considered in breeding rules',
                    'Fit demand',
                    'Periodic surveys',
                    'Continuous market intelligence + genetic index based on consumer preference'
                ]
            },
            { 
                id: 'q71', 
                weight: 0.04, 
                title: '7.1 Genetic and phenotypic trend calculated (ŒîG per generation or per year)',
                scores: [
                    'No trend',
                    'Once in old report',
                    'Every 3‚Äì4 years',
                    'Every 1‚Äì2 years',
                    'Every year + shared with program',
                    'Annual reporting + genomic trend estimation + stakeholder dissemination'
                ]
            },
            { 
                id: 'q72', 
                weight: 0.05, 
                title: '7.2 Realized vs expected gain (egg no., BW, survival)',
                scores: [
                    'Not checked',
                    'Checked once',
                    'Irregular',
                    'Checked & used',
                    'Checked regularly & reported',
                    'Integrated into annual evaluation cycle & used to redesign program'
                ]
            },
            { 
                id: 'q73', 
                weight: 0.04, 
                title: '7.3 Economic/household impact (ETB/hen/year)',
                scores: [
                    'None',
                    'Assumed',
                    'Small study',
                    'Annual sample survey',
                    'Built-in M&E module',
                    'Comprehensive cost‚Äìbenefit, return on investment & socioeconomic impact assessment'
                ]
            }
        ];

        window.DAIRY_LABELS = DAIRY_CRITERIA.map(c => c.title);
        window.DAIRY_CRITERIA = DAIRY_CRITERIA;
        window.POULTRY_LABELS = POULTRY_CRITERIA.map(c => c.title);

        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('dairy-date').valueAsDate = new Date();
            const poultryDate = document.getElementById('poultry-date');
            if (poultryDate) poultryDate.valueAsDate = new Date();
            initializeCharts();
            loadAssessmentsList();
            setTimeout(() => {
                injectDairyFramework();
                injectPoultryFramework();
            }, 100);
        });

        function showTab(tabName) {
            document.querySelectorAll('.content-area').forEach(el => el.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            document.querySelectorAll('.nav-link').forEach(el => el.classList.remove('active'));
            const navBtn = document.querySelector(`.nav-link[onclick*="${tabName}"]`);
            if (navBtn) navBtn.classList.add('active');
            
            if (tabName === 'view') loadAssessmentsList();
            if (tabName === 'results') {
                // Update only the stats cards, not the chart
                updateResultsStats();
            }
        }

        function loadSpecies(species) {
            document.getElementById('species-selector').style.display = 'none';
            document.getElementById(`${species}-assessment`).style.display = 'block';
            currentSpecies = species;
            if (species === 'dairy') updateDairyScores();
            else if (species === 'poultry') updatePoultryScores();
        }

        function backToSpecies() {
            document.getElementById('species-selector').style.display = 'block';
            document.getElementById(`${currentSpecies}-assessment`).style.display = 'none';
        }

        function showComingSoon(species) {
            alert(`üöß ${species} Assessment Coming Soon!\n\nWe are currently developing the assessment framework for ${species}. This feature will be available in a future update.\n\nStay tuned!`);
        }

        function updateScoreDisplay(id, value, maxScore) {
            document.getElementById(`display-${id}`).textContent = `${value} / ${maxScore}`;
        }

        function updateDairyScores() {
            const root = document.getElementById('dairy-assessment');
            if (!root) return;
            
            const sliders = root.querySelectorAll('#dairy-framework input[type="range"]');
            let totalWeightedScore = 0;
            let completedQuestions = 0;
            
            DAIRY_CRITERIA.forEach(criteria => {
                const slider = root.querySelector(`#dairy-${criteria.id}-slider`);
                const score = Number(slider?.value || 0);
                const weight = criteria.weight;
                
                // Normalize: score/5 gives 0 to 1, multiply by weight*100
                totalWeightedScore += (score / 5) * (weight * 100);
                if (score > 0) completedQuestions++;
            });

            const totalScore = Math.round(totalWeightedScore);
            const maxQuestions = DAIRY_CRITERIA.length;

            let status = 'Not Present';
            if (totalScore >= 85) status = 'Excellent';
            else if (totalScore >= 70) status = 'Strong';
            else if (totalScore >= 50) status = 'Moderate';
            else if (totalScore >= 30) status = 'Weak';
            else if (totalScore >= 15) status = 'Very Weak';

            document.getElementById('dairy-total').textContent = totalScore;
            document.getElementById('dairy-status').textContent = status;
            document.getElementById('dairy-completion').textContent = Math.round((completedQuestions / maxQuestions) * 100) + '%';
        
            const sectionScores = DAIRY_CRITERIA.map(criteria => 
                Number(root.querySelector(`#dairy-${criteria.id}-slider`)?.value || 0)
            );
            
            if (charts.results && currentSpecies === 'dairy') {
                charts.results.data.datasets[0].data = sectionScores;
                charts.results.data.datasets[0].backgroundColor = sectionScores.map(() => 'rgba(68, 114, 196, 0.8)');
                charts.results.data.datasets[0].borderColor = sectionScores.map(() => 'rgba(68, 114, 196, 1)');
                charts.results.data.labels = window.DAIRY_LABELS;
                charts.results.options.scales.y.max = 5;
                charts.results.update();
            }
        }
        
        function updatePoultryScores() {
            const root = document.getElementById('poultry-assessment');
            if (!root) return;
            
            let totalWeightedScore = 0;
            let completedQuestions = 0;
            
            POULTRY_CRITERIA.forEach(criteria => {
                const slider = root.querySelector(`#poultry-${criteria.id}-slider`);
                const score = Number(slider?.value || 0);
                const weight = criteria.weight;
                
                // Normalize: score/5 gives 0 to 1, multiply by weight*100
                totalWeightedScore += (score / 5) * (weight * 100);
                if (score > 0) completedQuestions++;
            });

            const totalScore = Math.round(totalWeightedScore);
            const maxQuestions = POULTRY_CRITERIA.length;

            let status = 'Initial';
            if (totalScore >= 85) status = 'Mature';
            else if (totalScore >= 70) status = 'Functional';
            else if (totalScore >= 50) status = 'Developing';
            else if (totalScore >= 30) status = 'Planned';
            
            document.getElementById('poultry-total').textContent = totalScore;
            document.getElementById('poultry-status').textContent = status;
            document.getElementById('poultry-completion').textContent = Math.round((completedQuestions / maxQuestions) * 100) + '%';

            const sectionScores = POULTRY_CRITERIA.map(criteria => 
                Number(root.querySelector(`#poultry-${criteria.id}-slider`)?.value || 0)
            );
            
            if (charts.results && currentSpecies === 'poultry') {
                charts.results.data.datasets[0].data = sectionScores;
                charts.results.data.labels = window.POULTRY_LABELS;
                charts.results.data.datasets[0].backgroundColor = sectionScores.map(() => 'rgba(237, 125, 49, 0.8)');
                charts.results.data.datasets[0].borderColor = sectionScores.map(() => 'rgba(237, 125, 49, 1)');
                charts.results.options.scales.y.max = 5;
                charts.results.update();
            }
        }
        
        function initializeCharts() {
            const ctx = document.getElementById('resultsChart');
            if (ctx) {
                if (charts.results) charts.results.destroy();
                
                charts.results = new Chart(ctx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: Array(40).fill().map((_, i) => `Q${i+1}`),
                        datasets: [{
                            label: 'Score',
                            data: Array(40).fill(0),
                            backgroundColor: 'rgba(68, 114, 196, 0.8)',
                            borderColor: 'rgba(68, 114, 196, 1)',
                            borderWidth: 2,
                            hoverBackgroundColor: 'rgba(68, 114, 196, 1)',
                            hoverBorderColor: 'rgba(68, 114, 196, 1)'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            mode: 'index',
                            intersect: false
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                min: 0,
                                max: 5,
                                ticks: { 
                                    stepSize: 1, 
                                    font: { size: 14, weight: 'bold' },
                                    color: '#334155'
                                },
                                title: { 
                                    display: true, 
                                    text: 'Score', 
                                    font: { size: 16, weight: 'bold' },
                                    color: '#1e293b',
                                    padding: { top: 10, bottom: 10 }
                                },
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.05)',
                                    lineWidth: 1
                                }
                            },
                            x: {
                                ticks: { 
                                    font: { size: 10 }, 
                                    maxRotation: 45, 
                                    minRotation: 45,
                                    color: '#64748b'
                                },
                                title: { 
                                    display: true, 
                                    text: 'Assessment Criteria', 
                                    font: { size: 16, weight: 'bold' },
                                    color: '#1e293b',
                                    padding: { top: 10, bottom: 10 }
                                },
                                grid: {
                                    display: false
                                }
                            }
                        },
                        plugins: {
                            legend: { 
                                display: false 
                            },
                            tooltip: { 
                                enabled: true,
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                titleColor: '#ffffff',
                                bodyColor: '#ffffff',
                                borderColor: 'rgba(255, 255, 255, 0.2)',
                                borderWidth: 1,
                                padding: 12,
                                displayColors: false,
                                callbacks: { 
                                    title: function(context) {
                                        return context[0].label;
                                    },
                                    label: function(context) { 
                                        const maxScore = context.chart.options.scales.y.max;
                                        return 'Score: ' + context.parsed.y + ' / ' + maxScore;
                                    }
                                } 
                            }
                        },
                        animation: {
                            duration: 1000,
                            easing: 'easeInOutQuart'
                        }
                    }
                });
            }
        }

        function updateResultsStats() {
            const allAssessments = JSON.parse(localStorage.getItem('ilri_all_assessments') || '[]');
            
            // If no assessments, show default values
            if (allAssessments.length === 0) {
                document.getElementById('results-total').textContent = '0';
                document.getElementById('results-status').textContent = 'No Data';
                return;
            }
            
            // Get the most recent assessment
            allAssessments.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            const lastAssessment = allAssessments[0];
            
            if (lastAssessment) {
                document.getElementById('results-total').textContent = lastAssessment.totalScore || '0';
                document.getElementById('results-status').textContent = lastAssessment.status || '--';
            }
        }

        function updateResultsChart() {
            // Always initialize if not already done
            if (!charts.results) {
                initializeCharts();
            }

            const allAssessments = JSON.parse(localStorage.getItem('ilri_all_assessments') || '[]');
            
            // If no assessments, show empty state message
            if (allAssessments.length === 0) {
                document.getElementById('results-total').textContent = '0';
                document.getElementById('results-status').textContent = 'No Data';
                document.getElementById('no-results-message').style.display = 'block';
                document.getElementById('resultsChart').parentElement.style.display = 'none';
                return;
            }
            
            // Hide empty state message, show chart
            document.getElementById('no-results-message').style.display = 'none';
            document.getElementById('resultsChart').parentElement.style.display = 'block';
            
            allAssessments.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            const lastAssessment = allAssessments[0];

            let scores = Array(40).fill(0);
            let species = 'dairy'; 
            let totalScore = '0';
            let status = '--';
            let labels = window.DAIRY_LABELS || [];
            let maxScore = 5;

            if (lastAssessment && lastAssessment.scores) {
                species = lastAssessment.program.toLowerCase().includes('poultry') ? 'poultry' : 'dairy';
                totalScore = lastAssessment.totalScore;
                status = lastAssessment.status;
                
                const scoresMap = lastAssessment.scores;

                if (species === 'poultry') {
                    scores = POULTRY_CRITERIA.map(c => Number(scoresMap[`${c.id}`]) || 0);
                    labels = window.POULTRY_LABELS;
                    maxScore = 5;
                } else {
                    scores = DAIRY_CRITERIA.map(c => Number(scoresMap[c.id]) || 0);
                    labels = window.DAIRY_LABELS;
                    maxScore = 5;
                }
            } 

            document.getElementById('results-total').textContent = totalScore;
            document.getElementById('results-status').textContent = status;

            const color = species === 'poultry' ? '#ED7D31' : '#4472C4';
            const rgbaColor = color.replace('#', '');
            const rgb = {
                r: parseInt(rgbaColor.substring(0, 2), 16) || 68,
                g: parseInt(rgbaColor.substring(2, 4), 16) || 114,
                b: parseInt(rgbaColor.substring(4, 6), 16) || 196
            };
            const barColor = `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, 0.8)`;
            const borderColor = `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, 1)`;
            
            if (charts.results) {
                charts.results.data.datasets[0].data = scores;
                charts.results.data.labels = labels;
                charts.results.data.datasets[0].backgroundColor = scores.map(() => barColor);
                charts.results.data.datasets[0].borderColor = scores.map(() => borderColor);
                charts.results.options.scales.y.min = 0;
                charts.results.options.scales.y.max = maxScore;
                charts.results.update();
            }
        }
        
        function saveDairyAssessment() {
            const root = document.getElementById('dairy-assessment');
            
            let totalWeightedScore = 0;
            const scoresMap = {};
            const commentsMap = {};
            
            DAIRY_CRITERIA.forEach(criteria => {
                const slider = root.querySelector(`#dairy-${criteria.id}-slider`);
                const commentBox = root.querySelector(`#dairy-${criteria.id}-comment`);
                const score = Number(slider?.value || 0);
                const weight = criteria.weight;
                
                totalWeightedScore += (score / 5) * (weight * 100);
                scoresMap[criteria.id] = score;
                commentsMap[criteria.id] = commentBox?.value || '';
            });

            const totalScore = Math.round(totalWeightedScore);
            
            let status = 'Not Present';
            if (totalScore >= 85) status = 'Excellent';
            else if (totalScore >= 70) status = 'Strong';
            else if (totalScore >= 50) status = 'Moderate';
            else if (totalScore >= 30) status = 'Weak';
            else if (totalScore >= 15) status = 'Very Weak';
            
            const data = {
                program: 'African Dairy Genetics (ADG/TDGG)',
                evaluator: document.getElementById('dairy-evaluator').value,
                date: document.getElementById('dairy-date').value,
                country: document.getElementById('dairy-country').value,
                breed: document.getElementById('dairy-breed').value,
                timestamp: new Date().toISOString(),
                totalScore: totalScore,
                status: status,
                scores: scoresMap,
                comments: commentsMap,
                additionalData: {}
            };
            
            let allAssessments = JSON.parse(localStorage.getItem('ilri_all_assessments') || '[]');
            data.id = Date.now();
            allAssessments.push(data);
            
            localStorage.setItem('ilri_all_assessments', JSON.stringify(allAssessments));
            
            alert('‚úì Dairy Assessment saved successfully!');
            loadAssessmentsList();
        }

        function savePoultryAssessment() {
            const root = document.getElementById('poultry-assessment');
            
            let totalWeightedScore = 0;
            const scoresMap = {};
            const commentsMap = {};
            
            POULTRY_CRITERIA.forEach(criteria => {
                const slider = root.querySelector(`#poultry-${criteria.id}-slider`);
                const commentBox = root.querySelector(`#poultry-${criteria.id}-comment`);
                const score = Number(slider?.value || 0);
                const weight = criteria.weight;
                
                totalWeightedScore += (score / 5) * (weight * 100);
                scoresMap[criteria.id] = score;
                commentsMap[criteria.id] = commentBox?.value || '';
            });

            const totalScore = Math.round(totalWeightedScore);
            
            let status = 'Initial';
            if (totalScore >= 85) status = 'Mature';
            else if (totalScore >= 70) status = 'Functional';
            else if (totalScore >= 50) status = 'Developing';
            else if (totalScore >= 30) status = 'Planned';
            
            const data = {
                program: 'Poultry Assessment - Young Program',
                evaluator: document.getElementById('poultry-evaluator').value,
                date: document.getElementById('poultry-date').value,
                country: document.getElementById('poultry-country').value,
                breed: document.getElementById('poultry-breed').value,
                timestamp: new Date().toISOString(),
                totalScore: totalScore,
                status: status,
                scores: scoresMap,
                comments: commentsMap,
                additionalData: {}
            };
            
            let allAssessments = JSON.parse(localStorage.getItem('ilri_all_assessments') || '[]');
            data.id = Date.now();
            allAssessments.push(data);
            
            localStorage.setItem('ilri_all_assessments', JSON.stringify(allAssessments));
            
            alert('‚úì Poultry Assessment saved successfully!');
            loadAssessmentsList();
        }

        function loadAssessmentsList() {
            const allAssessments = JSON.parse(localStorage.getItem('ilri_all_assessments') || '[]');
            const listContainer = document.getElementById('assessments-list');
            const noAssessmentsDiv = document.getElementById('no-assessments');
            
            if (allAssessments.length === 0) {
                listContainer.innerHTML = '';
                listContainer.style.display = 'none';
                noAssessmentsDiv.style.display = 'block';
                document.getElementById('view-detail').style.display = 'none';
                return;
            }
            
            noAssessmentsDiv.style.display = 'none';
            document.getElementById('view-detail').style.display = 'none';
            listContainer.style.display = 'block';
            
            allAssessments.sort((a, b) => new Date(b.timestamp || b.date) - new Date(a.timestamp || a.date));
            
            listContainer.innerHTML = allAssessments.map((assessment) => {
                const displayDate = assessment.date ? new Date(assessment.date).toLocaleDateString() : 'No date';
                const icon = assessment.program.includes('Poultry') ? 'üêì' : 'üêÑ';
                const color = assessment.program.includes('Poultry') ? 'var(--poultry-color)' : 'var(--dairy-color)';
                
                return `
                    <div class="assessment-item-card" onclick="viewAssessmentDetail(${assessment.id})">
                        <div class="assessment-item-header">
                            <div>
                                <h5 style="margin: 0; color: ${color};">
                                    <i class="fas fa-clipboard-check"></i> ${icon} ${assessment.program}
                                </h5>
                                <p style="margin: 5px 0 0 0; color: #64748b; font-size: 0.9em;">
                                    ${assessment.evaluator || 'Unknown'} ‚Ä¢ ${assessment.country || 'N/A'} ‚Ä¢ ${assessment.breed || 'N/A'}
                                </p>
                            </div>
                            <div style="text-align: right;">
                                <div class="score-badge ${getScoreBadgeClass(assessment.totalScore)}">
                                    ${assessment.totalScore} / 100
                                </div>
                                <p class="assessment-date" style="margin: 5px 0 0 0;">
                                    ${displayDate}
                                </p>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getScoreBadgeClass(score) {
            score = parseFloat(score);
            if (score >= 85) return 'score-excellent';
            if (score >= 70) return 'score-good';
            if (score >= 50) return 'score-fair';
            return 'score-poor';
        }

        function viewAssessmentDetail(id) {
            const allAssessments = JSON.parse(localStorage.getItem('ilri_all_assessments') || '[]');
            const assessment = allAssessments.find(a => a.id === id);
            
            if (!assessment) { alert('Assessment not found!'); return; }
            
            currentViewAssessment = assessment;
            
            document.getElementById('assessments-list').style.display = 'none';
            document.getElementById('no-assessments').style.display = 'none';
            document.getElementById('view-detail').style.display = 'block';
            
            document.getElementById('view-program').textContent = assessment.program;
            document.getElementById('view-evaluator').textContent = assessment.evaluator || 'N/A';
            document.getElementById('view-date').textContent = new Date(assessment.date).toLocaleDateString();
            document.getElementById('view-country').textContent = assessment.country || 'N/A';
            document.getElementById('view-breed').textContent = assessment.breed || 'N/A';
            document.getElementById('view-total-score').textContent = assessment.totalScore;
            
            const statusBadge = document.getElementById('view-status-badge');
            statusBadge.textContent = assessment.status;
            statusBadge.className = 'score-badge ' + getScoreBadgeClass(assessment.totalScore);
            
            const scoresList = Object.keys(assessment.scores).map(key => ({
                label: key.includes('_') ? key.replace(/_/g, ' ') : key,
                score: assessment.scores[key],
                comment: assessment.comments ? (assessment.comments[key] || '') : ''
            }));

            const completed = scoresList.filter(s => s.score > 0).length;
            document.getElementById('view-completion').textContent = Math.round((completed / scoresList.length) * 100) + '%';
            
            const isPoultry = assessment.program.includes('Poultry');
            const maxScore = 5;
            
            const sectionsHtml = scoresList.map(item => `
                <div class="view-item" style="flex-direction: column; align-items: flex-start;">
                    <div style="display: flex; justify-content: space-between; width: 100%; margin-bottom: 8px;">
                        <span class="view-label">${item.label}:</span>
                        <span class="view-value">${item.score} / ${maxScore}</span>
                    </div>
                    ${item.comment ? `<div style="background: #f8fafc; padding: 10px; border-radius: 6px; width: 100%; font-size: 0.9em; color: #475569;"><strong>Comment:</strong> ${item.comment}</div>` : ''}
                </div>
            `).join('');

            document.getElementById('view-sections').innerHTML = sectionsHtml;
        }

        function backToAssessmentList() {
            document.getElementById('assessments-list').style.display = 'block';
            document.getElementById('view-detail').style.display = 'none';
            currentViewAssessment = null;
            loadAssessmentsList();
        }
        
        function loadAssessmentForEdit() {
            if (!currentViewAssessment) return;
            
            const species = currentViewAssessment.program.toLowerCase().includes('poultry') ? 'poultry' : 'dairy';

            document.getElementById(`${species}-evaluator`).value = currentViewAssessment.evaluator || '';
            document.getElementById(`${species}-date`).value = currentViewAssessment.date || '';
            document.getElementById(`${species}-country`).value = currentViewAssessment.country || '';
            document.getElementById(`${species}-breed`).value = currentViewAssessment.breed || '';
            
            const framework = species === 'poultry' ? document.getElementById('poultry-framework') : document.getElementById('dairy-framework');
            const scoresMap = currentViewAssessment.scores;
            const commentsMap = currentViewAssessment.comments || {};

            const criteria = species === 'poultry' ? POULTRY_CRITERIA : DAIRY_CRITERIA;
            const maxScore = 5;
            
            criteria.forEach((crit) => {
                const key = crit.id;
                const scoreValue = scoresMap[key] || 0;
                const commentValue = commentsMap[key] || '';
                const baseKey = `${species}-${crit.id}`;
                
                const slider = framework.querySelector(`#${baseKey}-slider`);
                if (slider) {
                    slider.value = scoreValue;
                    updateScoreDisplay(`${baseKey}-slider`, scoreValue, maxScore);
                }
                
                const select = framework.querySelector(`#${baseKey}-select`);
                if (select) {
                    select.value = scoreValue;
                }
                
                const commentBox = framework.querySelector(`#${baseKey}-comment`);
                if (commentBox) {
                    commentBox.value = commentValue;
                }
            });
            
            if (species === 'dairy') {
                updateDairyScores();
            } else {
                updatePoultryScores();
            }
            
            loadSpecies(species);
            showTab('assessment');
        }

        function deleteCurrentAssessment() {
            if (!currentViewAssessment) return;
            
            if (!confirm('Are you sure you want to delete this assessment? This cannot be undone.')) {
                return;
            }
            
            let allAssessments = JSON.parse(localStorage.getItem('ilri_all_assessments') || '[]');
            allAssessments = allAssessments.filter(a => a.id !== currentViewAssessment.id);
            localStorage.setItem('ilri_all_assessments', JSON.stringify(allAssessments));
            
            currentViewAssessment = null;
            alert('‚úì Assessment deleted successfully!');
            backToAssessmentList();
        }

        function exportJSON() {
            const data = localStorage.getItem('ilri_all_assessments');
            if (data) {
                const blob = new Blob([data], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `ILRI_Assessments_${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                alert('‚úì Data exported!');
            } else {
                alert('‚ö† No assessment data found.');
            }
        }
        
        function generatePDFReport() {
            const allAssessments = JSON.parse(localStorage.getItem('ilri_all_assessments') || '[]');
            if (allAssessments.length === 0) {
                alert('No assessments found to export.');
                return;
            }
            
            allAssessments.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            const assessment = allAssessments[0];
            
            const species = assessment.program.toLowerCase().includes('poultry') ? 'poultry' : 'dairy';
            const criteria = species === 'poultry' ? POULTRY_CRITERIA : DAIRY_CRITERIA;
            const maxScore = 5;
            
            let reportHTML = `
                <h1>üêÑ ILRI Livestock Genetics Assessment Report</h1>
                
                <div class="meta">
                    <div class="meta-item">
                        <div class="meta-label">Program</div>
                        <div class="meta-value">${assessment.program}</div>
                    </div>
                    <div class="meta-item">
                        <div class="meta-label">Evaluator</div>
                        <div class="meta-value">${assessment.evaluator || 'N/A'}</div>
                    </div>
                    <div class="meta-item">
                        <div class="meta-label">Date</div>
                        <div class="meta-value">${new Date(assessment.date).toLocaleDateString()}</div>
                    </div>
                    <div class="meta-item">
                        <div class="meta-label">Country</div>
                        <div class="meta-value">${assessment.country || 'N/A'}</div>
                    </div>
                    <div class="meta-item">
                        <div class="meta-label">Breed/Line</div>
                        <div class="meta-value">${assessment.breed || 'N/A'}</div>
                    </div>
                    <div class="meta-item">
                        <div class="meta-label">Generated</div>
                        <div class="meta-value">${new Date().toLocaleString()}</div>
                    </div>
                </div>
                
                <div class="summary-box">
                    <h3>Overall Assessment Summary</h3>
                    <table style="margin-top: 10px;">
                        <tr>
                            <td><strong>Total Score</strong></td>
                            <td class="score-cell">${assessment.totalScore} / 100</td>
                        </tr>
                        <tr>
                            <td><strong>Program Status</strong></td>
                            <td>${assessment.status}</td>
                        </tr>
                        <tr>
                            <td><strong>Scoring Scale</strong></td>
                            <td>0 - ${maxScore} (0=Not Present, 5=Excellent)</td>
                        </tr>
                    </table>
                </div>
                
                <h2>Detailed Scores & Comments</h2>
                <table>
                    <thead>
                        <tr>
                            <th style="width: 5%;">#</th>
                            <th style="width: 40%;">Criterion</th>
                            <th style="width: 10%;">Score</th>
                            <th style="width: 45%;">Comments</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            const scoreKeys = Object.keys(assessment.scores);
            scoreKeys.forEach((key, index) => {
                const score = assessment.scores[key];
                const comment = assessment.comments ? (assessment.comments[key] || 'No comment') : 'No comment';
                const criteriaItem = criteria.find(c => c.id === key);
                const label = criteriaItem ? criteriaItem.title : key.replace(/_/g, ' ');
                
                reportHTML += `
                    <tr>
                        <td style="text-align: center;">${index + 1}</td>
                        <td>${label}</td>
                        <td class="score-cell">${score} / ${maxScore}</td>
                        <td class="comment-cell">${comment}</td>
                    </tr>
                `;
            });
            
            reportHTML += `
                    </tbody>
                </table>
                
                <div style="margin-top: 40px; padding: 20px; background: #f8fafc; border-radius: 8px; text-align: center;">
                    <p style="margin: 0; color: #64748b;">
                        <strong>International Livestock Research Institute (ILRI)</strong><br>
                        Professional Breeding Program Evaluation Platform<br>
                        ¬© ${new Date().getFullYear()} ILRI
                    </p>
                </div>
            `;
            
            document.getElementById('print-report').innerHTML = reportHTML;
            
            setTimeout(() => {
                window.print();
            }, 100);
        }

        function exportExcel() {
            if (typeof XLSX === 'undefined') { alert('Excel library not loaded.'); return; }
            
            const wb = XLSX.utils.book_new();
            const allAssessments = JSON.parse(localStorage.getItem('ilri_all_assessments') || '[]');
            
            if (allAssessments.length === 0) {
                alert('No saved assessments to export.');
                return;
            }
            
            const headers = ['ID', 'Date', 'Evaluator', 'Country', 'Breed', 'Program', 'Total Score', 'Status'];
            const data = [headers];

            allAssessments.forEach(a => {
                const row = [
                    a.id,
                    a.date,
                    a.evaluator,
                    a.country,
                    a.breed,
                    a.program,
                    a.totalScore,
                    a.status
                ];
                data.push(row);
            });
            
            const ws = XLSX.utils.aoa_to_sheet(data);
            XLSX.utils.book_append_sheet(wb, ws, 'Assessments');
            XLSX.writeFile(wb, 'ilri-assessments.xlsx');
        }

        function injectDairyFramework() {
            const root = document.getElementById('dairy-assessment');
            if (!root) return;
            
            let wrap = document.getElementById('dairy-framework');
            if (!wrap) {
                wrap = document.createElement('div');
                wrap.id = 'dairy-framework';
                const statsGrid = root.querySelector('.stats-grid');
                if (statsGrid) {
                    statsGrid.insertAdjacentElement('afterend', wrap);
                }
            }
            
            let html = '';
            let currentSection = '';
            
            DAIRY_CRITERIA.forEach((crit, idx) => {
                const section = crit.section;
                const color = getComputedStyle(document.documentElement).getPropertyValue('--dairy-color').trim();
                
                if (section !== currentSection) {
                    currentSection = section;
                    html += `<div class="assessment-section-header" style="background: ${color}">${section}</div>`;
                }
                
                html += `
                    <div class="question-card" style="border-left-color: ${color}">
                        <div class="question-label">${crit.title}</div>
                        <select class="form-select mb-3" id="dairy-${crit.id}-select">
                            <option value="0">0 - Not Present</option>
                            <option value="1">1 - Very Weak</option>
                            <option value="2">2 - Weak</option>
                            <option value="3">3 - Moderate</option>
                            <option value="4">4 - Strong</option>
                            <option value="5">5 - Excellent</option>
                        </select>
                        <label>Score (0-5)</label>
                        <input type="range" class="form-range" min="0" max="5" step="1" value="0" id="dairy-${crit.id}-slider">
                        <div class="score-display" style="background: ${color}" id="display-dairy-${crit.id}-slider">0 / 5</div>
                        <div class="comment-section">
                            <label for="dairy-${crit.id}-comment"><i class="fas fa-comment-dots"></i> Comments / Evidence:</label>
                            <textarea id="dairy-${crit.id}-comment" class="assessment-comment" placeholder="Provide detailed observations, evidence, current status, and recommendations..."></textarea>
                        </div>
                    </div>
                `;
            });
            
            wrap.innerHTML = html;
            
            DAIRY_CRITERIA.forEach(crit => {
                const sel = document.getElementById(`dairy-${crit.id}-select`);
                const sld = document.getElementById(`dairy-${crit.id}-slider`);
                
                sel.addEventListener('change', () => {
                    sld.value = sel.value;
                    updateScoreDisplay(`dairy-${crit.id}-slider`, sel.value, 5);
                    updateDairyScores();
                });
                
                sld.addEventListener('input', () => {
                    sel.value = sld.value;
                    updateScoreDisplay(`dairy-${crit.id}-slider`, sld.value, 5);
                    updateDairyScores();
                });
            });
            
            updateDairyScores();
        }

        function injectPoultryFramework() {
            const root = document.getElementById('poultry-assessment');
            if (!root) return;
            
            let wrap = document.getElementById('poultry-framework');
            if (!wrap) {
                wrap = document.createElement('div');
                wrap.id = 'poultry-framework';
                const statsGrid = root.querySelector('.stats-grid');
                if (statsGrid) {
                    statsGrid.insertAdjacentElement('afterend', wrap);
                }
            }
            
            let html = '';
            let currentSection = '';
            
            POULTRY_CRITERIA.forEach((crit, idx) => {
                const section = crit.title.split('.')[0];
                const color = getComputedStyle(document.documentElement).getPropertyValue('--poultry-color').trim();
                
                if (section !== currentSection) {
                    currentSection = section;
                    html += `<div class="assessment-section-header" style="background: ${color}">${section}</div>`;
                }
                
                // Build select options from rubric scores
                let selectOptions = '';
                crit.scores.forEach((scoreDesc, scoreVal) => {
                    selectOptions += `<option value="${scoreVal}">${scoreVal} - ${scoreDesc}</option>`;
                });
                
                html += `
                    <div class="question-card" style="border-left-color: ${color}">
                        <div class="question-label">${crit.title} [Weight: ${(crit.weight*100).toFixed(0)}%]</div>
                        <select class="form-select mb-3" id="poultry-${crit.id}-select">
                            ${selectOptions}
                        </select>
                        <label>Score (0-5)</label>
                        <input type="range" class="form-range" min="0" max="5" step="1" value="0" id="poultry-${crit.id}-slider">
                        <div class="score-display" style="background: ${color}" id="display-poultry-${crit.id}-slider">0 / 5</div>
                        <div class="comment-section">
                            <label for="poultry-${crit.id}-comment"><i class="fas fa-comment-dots"></i> Evaluator Remarks (Essential for young programs):</label>
                            <textarea id="poultry-${crit.id}-comment" class="assessment-comment" placeholder="Document current status, implementation plans, timeline, and challenges. Be specific about what exists and what is planned."></textarea>
                        </div>
                    </div>
                `;
            });
            
            wrap.innerHTML = html;
            
            POULTRY_CRITERIA.forEach(crit => {
                const sel = document.getElementById(`poultry-${crit.id}-select`);
                const sld = document.getElementById(`poultry-${crit.id}-slider`);
                
                sel.addEventListener('change', () => {
                    sld.value = sel.value;
                    updateScoreDisplay(`poultry-${crit.id}-slider`, sel.value, 5);
                    updatePoultryScores();
                });
                
                sld.addEventListener('input', () => {
                    sel.value = sld.value;
                    updateScoreDisplay(`poultry-${crit.id}-slider`, sld.value, 5);
                    updatePoultryScores();
                });
            });
            
            updatePoultryScores();
        }
    </script>
</body>
</html>
